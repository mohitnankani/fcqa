{"version":3,"file":"employee-assignment.js","sources":["../../dependency-sets/employee-assignment/helpers/ssEmployeeAssignmentHlp/employee-assignment.js"],"sourcesContent":["function ssEmployeeAssignmentHlp(ssDateHlp, enumPayRateFrequency, ssDateByOrgHlp, ssArrayHlp, ssJobTypeHlp, ssDeprecated) {\r\n\r\n\tconst detailKeys = [\r\n\t\t'_payLane',\r\n\t\t'_payStep',\r\n\t\t'_workDaysPerYear',\r\n\t\t'_payPeriodsPerYear',\r\n\t\t'_hoursPerDay',\r\n\t\t'_fTE',\r\n\t\t'_vacationDaysPerSchoolYear',\r\n\t\t'_sickDaysPerSchoolYear',\r\n\t\t'_personalDaysPerSchoolYear',\r\n\t\t'_paidHolidaysPerSchoolYear',\r\n\t\t'_payRateFrequency',\r\n\t\t'_payRate'\r\n\t];\r\n\r\n\treturn {\r\n\t\t// #--------------------------------# //\r\n\t\t// #---- Helper (assignmentHlp) ----# //\r\n\t\tgetEmployementGroup,\r\n\t\tgetEmploymentGroup,\r\n\t\tjobTypeValuesForAssignment,\r\n\t\tcalculatePayPerPeriod,\r\n\t\tcalculateAnnualSalary,\r\n\t\tgetPayRate,\r\n\t\tgetPayRateFequency: getPayRateFrequency,\r\n\t\tgetPayRateFrequency,\r\n\t\tcalculatePayRate: ssDeprecated(\r\n\t\t\t'ssEmployeeAssignmentHlp.calculatePayRate()',\r\n\t\t\t'ssEmployeeAssignmentHlp.getPayRate()',\r\n\t\t\tgetPayRate\r\n\t\t),\r\n\t\tgetPrimaryAssignment,\r\n\t\tgetEarliestOtherAssignment,\r\n\t\tgetPayRateFrequencyString,\r\n\t\tjobTypeDetailFields,\r\n\t\t// #-- END Helper (assignmentHlp) --# //\r\n\t\t// #--------------------------------# //\r\n\t};\r\n\r\n\tfunction calculatePayPerPeriod({ annualSalary = null, calculatedSalary = null, payPeriodsPerYear }) {\r\n\t\tvar salary = annualSalary == null ? calculatedSalary : annualSalary;\r\n\t\treturn (payPeriodsPerYear <= 0 || salary <= 0) ? 0 : salary / payPeriodsPerYear;\r\n\t}\r\n\r\n\tfunction calculateAnnualSalary({ payRateFrequency, payRate, hoursPerDay, workDaysPerYear }) {\r\n\t\treturn payRateFrequency === enumPayRateFrequency.annually ? payRate : (payRate * hoursPerDay * workDaysPerYear);\r\n\t}\r\n\r\n\tfunction getPayRate({ paySchedule, currentDetails }) {\r\n\t\tif (currentDetails._payLane == null || currentDetails._payStep == null) { return 0; }\r\n\t\treturn getVal(paySchedule, 'payLanes')[currentDetails._payLane].paySteps[currentDetails._payStep].payRate;\r\n\t}\r\n\r\n\tfunction getEmployementGroup({ employementGroups, jobType }) {\r\n\t\treturn getEmploymentGroup({ employmentGroups: employementGroups, jobType });\r\n\t}\r\n\r\n\tfunction getEmploymentGroup({ employmentGroups, jobType }) {\r\n\t\treturn employmentGroups.find(g => g.value === jobType._bargainingUnit.id);\r\n\t}\r\n\r\n\tfunction getPayRateFrequency({ paySchedule, assignmentDetails }) {\r\n\t\tif (ssJobTypeHlp.isValidPS(paySchedule)) {\r\n\t\t\treturn getVal(paySchedule, 'payRateFrequency');\r\n\t\t} else {\r\n\t\t\treturn (assignmentDetails._payRateFrequency != null) ? assignmentDetails._payRateFrequency : getVal(paySchedule, 'payRateFrequency');\r\n\t\t}\r\n\t}\r\n\r\n\tfunction jobTypeValuesForAssignment({ paySchedule, jobTypeDetails, assignmentDetails = {} }) {\r\n\t\tconst obj = detailKeys.reduce(function(prev, key) {\r\n\t\t\tprev[key] = (assignmentDetails[key] == null) ? jobTypeDetails[key] : assignmentDetails[key];\r\n\t\t\treturn prev;\r\n\t\t}, {});\r\n\t\tobj._payRateFrequency = getPayRateFrequency({ paySchedule, assignmentDetails });\r\n\t\tconst _jobTypeValuesForAssignmentAreValid = (assignmentDetails._payRateFrequency === enumPayRateFrequency.annually) ?\r\n\t\t\ttrue :\r\n\t\t\t(detailPropIsValid(obj._hoursPerDay) && detailPropIsValid(obj._workDaysPerYear) && detailPropIsValid(obj._payPeriodsPerYear) && assignmentDetails._payRateFrequency !== null);\r\n\t\treturn Object.assign(obj, { _jobTypeValuesForAssignmentAreValid });\r\n\t}\r\n\r\n\t/*\r\n\t * Given an employee with _assignments, this will find the assignment that exists at the _asOf time of the form instance.\r\n\t * Also handles formatting concerns for the relative day of the assignment\r\n\t * NOTE: formattedStartDateUtc might be out of sync eventually with _startDateUtc if _startDateUtc is updated. Same for formattedEndDateUtc.\r\n\t */\r\n\tfunction getPrimaryAssignment(emp, instance, org) {\r\n\t\tif (instance === void 0) { instance = null; }\r\n\r\n\t\tif (emp._assignments == null) { return; }\r\n\t\tif (emp._assignments.length === 0) { return; }\r\n\t\tlet asOfDate = (instance) ? instance._asOf : null;\r\n\r\n\t\tvar primaryAssignment = emp._assignments.find(a => a._isPrimary && ssDateByOrgHlp.isCurrent({ obj: a, asOfDate, fromProp: '_startDateUtc', toProp: '_endDateUtc', org }));\r\n\r\n\t\tif (primaryAssignment) {\r\n\t\t\tvar startDate = primaryAssignment._startDateUtc;\r\n\t\t\tvar endDate = primaryAssignment._endDateUtc;\r\n\r\n\t\t\tprimaryAssignment.formattedStartDateUtc = (ssDateHlp.isForeverPast(startDate)) ? '' : ssDateByOrgHlp.utcIsoToRelativeMoment(startDate, org).format('MM/DD/YYYY');\r\n\t\t\tprimaryAssignment.formattedEndDateUtc = (ssDateHlp.isForeverFuture(endDate)) ? '' : ssDateByOrgHlp.utcIsoToRelativeMoment(endDate, org).format('MM/DD/YYYY');\r\n\t\t}\r\n\t\treturn primaryAssignment;\r\n\t}\r\n\r\n\tfunction getEarliestOtherAssignment(emp, instance, org) {\r\n\t\tif (instance === void 0) { instance = null; }\r\n\t\t/*\r\n\t\t\tFPS-1901\r\n\t\t\t_areSortingSecondaryAssignmentsByLatest is a property that we are adding on new form instanceStep\r\n\t\t\tThis new property will sort the assignments By Latest so moving on all the new instances will have the\r\n\t\t\tsorting by Latest and absence of this property will sort the assignments By Earliest which will\r\n\t\t\tkeep data intact for old instances out and signed in Production\r\n\r\n\t\t\tThis function name is misleading and reason we didn't change that because we have to change this name\r\n\t\t\tin couple of places which is increasing the scope and we didn't have the time to do day before Thanksgiving :)\r\n\t\t*/\r\n\t\tif (emp._assignments == null) { return; }\r\n\t\tif (emp._assignments.length === 0) { return; }\r\n\t\tlet asOfDate = (instance) ? instance._asOf : null;\r\n\r\n\t\t// In the interim, if we have the org of the logged in user use the new one to make dates relative to that org, otherwise use the old one that doesn't\r\n\t\t// <revert this conditional once all code locations have been moved to pass in the org.  ssEffectiveDateHlp.isCurrent() has been deprecated.>\r\n\t\tvar otherAssignments = emp._assignments.filter(a => !a._isPrimary && ssDateByOrgHlp.isCurrent({ obj: a, asOfDate, fromProp: '_startDateUtc', toProp: '_endDateUtc', org }));\r\n\r\n\t\tlet areSortingSecondaryAssignmentsByLatest = instance._areSortingSecondaryAssignmentsByLatest;\r\n\t\tvar sortedByCreatedDate = ssArrayHlp.sortByObjectKey(\r\n\t\t\totherAssignments,\r\n\t\t\t'_createdUtc', // key\r\n\t\t\t!!areSortingSecondaryAssignmentsByLatest // order\r\n\t\t);\r\n\t\tvar sortedByStartDate = ssArrayHlp.sortByObjectKey(\r\n\t\t\tsortedByCreatedDate,\r\n\t\t\t'_startDateUtc', // key\r\n\t\t\t!!areSortingSecondaryAssignmentsByLatest // order\r\n\t\t);\r\n\t\tvar assignment = sortedByStartDate[0];\r\n\t\tif (assignment) {\r\n\t\t\tvar startDate = assignment._startDateUtc;\r\n\t\t\tvar endDate = assignment._endDateUtc;\r\n\t\t\tassignment.formattedStartDateUtc = (ssDateHlp.isForeverPast(startDate)) ? '' : ssDateByOrgHlp.utcIsoToRelativeMoment(startDate, org).format('MM/DD/YYYY');\r\n\t\t\tassignment.formattedEndDateUtc = (ssDateHlp.isForeverFuture(endDate)) ? '' : ssDateByOrgHlp.utcIsoToRelativeMoment(endDate, org).format('MM/DD/YYYY');\r\n\t\t}\r\n\t\treturn assignment;\r\n\t}\r\n\r\n\tfunction getPayRateFrequencyString(payRateFrequency, payRateOptions) {\r\n\t\tif (payRateFrequency == null) { return 'N/A'; }\r\n\t\treturn payRateOptions.find(x => x.value === payRateFrequency).name;\r\n\t}\r\n\r\n\tfunction jobTypeDetailFields() {\r\n\t\treturn [\r\n\t\t\t[{\r\n\t\t\t\tprop: '_fTE',\r\n\t\t\t\tdisplayText: 'FTE',\r\n\t\t\t\tdataTest: 'fte',\r\n\t\t\t}, {\r\n\t\t\t\tprop: '_hoursPerDay',\r\n\t\t\t\tdisplayText: 'Hours/Day',\r\n\t\t\t\tdataTest: 'hours-per-day',\r\n\t\t\t}, {\r\n\t\t\t\tprop: '_workDaysPerYear',\r\n\t\t\t\tdisplayText: 'Work Days/Year',\r\n\t\t\t\tdataTest: 'work-days-per-year',\r\n\t\t\t}],\r\n\t\t\t[{\r\n\t\t\t\tprop: '_sickDaysPerSchoolYear',\r\n\t\t\t\tdisplayText: 'Sick Days/Year',\r\n\t\t\t\tdataTest: 'sick-days-per-school-year',\r\n\t\t\t}, {\r\n\t\t\t\tprop: '_personalDaysPerSchoolYear',\r\n\t\t\t\tdisplayText: 'Personal Days/Year',\r\n\t\t\t\tdataTest: 'personal-days-per-school-year',\r\n\t\t\t}, {\r\n\t\t\t\tprop: '_vacationDaysPerSchoolYear',\r\n\t\t\t\tdisplayText: 'Vacation Days/Year',\r\n\t\t\t\tdataTest: 'vacation-days-per-school-year',\r\n\t\t\t}]\r\n\t\t];\r\n\t}\r\n}\r\n\r\nfunction detailPropIsValid(val) {\r\n\tif (val == null) { return false; }\r\n\treturn val !== 0;\r\n}\r\n\r\n/**\r\n * Gets a value checking the non-underscore property then checks the underscore property\r\n * @param {Object} model\r\n * @param {String} prop\r\n */\r\nfunction getVal(model, prop) {\r\n\tif (model.hasOwnProperty(prop)) { return model[prop]; }\r\n\tif (model.hasOwnProperty(`_${prop}`)) { return model[`_${prop}`]; }\r\n}\r\n\r\nangular.module('super-suit-helpers').factory('ssEmployeeAssignmentHlp', ssEmployeeAssignmentHlp);\r\n"],"names":["ssEmployeeAssignmentHlp","ssDateHlp","enumPayRateFrequency","ssDateByOrgHlp","ssArrayHlp","ssJobTypeHlp","ssDeprecated","getPayRate","paySchedule","currentDetails","_payLane","_payStep","getVal","paySteps","payRate","getEmploymentGroup","employmentGroups","jobType","find","g","value","_bargainingUnit","id","getPayRateFrequency","assignmentDetails","isValidPS","_payRateFrequency","detailKeys","employementGroups","jobTypeDetails","obj","reduce","prev","key","_jobTypeValuesForAssignmentAreValid","annually","detailPropIsValid","_hoursPerDay","_workDaysPerYear","_payPeriodsPerYear","Object","assign","annualSalary","calculatedSalary","payPeriodsPerYear","salary","payRateFrequency","hoursPerDay","workDaysPerYear","emp","instance","org","_assignments","length","asOfDate","_asOf","primaryAssignment","a","_isPrimary","isCurrent","fromProp","toProp","startDate","_startDateUtc","endDate","_endDateUtc","formattedStartDateUtc","isForeverPast","utcIsoToRelativeMoment","format","formattedEndDateUtc","isForeverFuture","otherAssignments","filter","areSortingSecondaryAssignmentsByLatest","_areSortingSecondaryAssignmentsByLatest","sortedByCreatedDate","sortByObjectKey","sortedByStartDate","assignment","payRateOptions","x","name","val","model","prop","hasOwnProperty","angular","module","factory"],"mappings":"yBAAA,QAASA,EAAT,CAAiCC,CAAjC,CAA4CC,CAA5C,CAAkEC,CAAlE,CAAkFC,CAAlF,CAA8FC,CAA9F,CAA4GC,CAA5G,CAA0H,SAkDhHC,KAA4C,IAA/BC,KAAAA,YAAaC,IAAAA,eAAkB,MACrB,KAA3BA,IAAeC,QAAfD,EAA8D,IAA3BA,IAAeE,QADF,CAC6B,CAD7B,CAE7CC,EAAOJ,CAAPI,CAAoB,UAApBA,EAAgCH,EAAeC,QAA/CE,EAAyDC,QAAzDD,CAAkEH,EAAeE,QAAjFC,EAA2FE,gBAO1FC,KAAkD,IAA7BC,KAAAA,iBAAkBC,IAAAA,cACxCD,GAAiBE,IAAjBF,CAAsB,UAAA,QAAKG,GAAEC,KAAFD,GAAYF,EAAQI,eAARJ,CAAwBK,EAA/D,CAAAN,UAGCO,KAAwD,IAAlCf,KAAAA,YAAagB,IAAAA,kBAAqB,MAC5DnB,GAAaoB,SAAbpB,CAAuBG,CAAvBH,CAD4D,CAExDO,EAAOJ,CAAPI,CAAoB,kBAApBA,CAFwD,CAIhB,IAAvCY,IAAkBE,iBAAlBF,CAAqFZ,EAAOJ,CAAPI,CAAoB,kBAApBA,CAArFY,CAA+CA,EAAkBE;;;;QAjErEC,GAAa,CAClB,UADkB,CAElB,UAFkB,CAGlB,kBAHkB,CAIlB,oBAJkB,CAKlB,cALkB,CAMlB,MANkB,CAOlB,4BAPkB,CAQlB,wBARkB,CASlB,4BATkB,CAUlB,4BAVkB,CAWlB,mBAXkB,CAYlB,UAZkB,QAeZ;;+BAsCsD,IAA9BC,KAAAA,kBAAmBX,IAAAA,cAC1CF,GAAmB,CAAEC,iBAAkBY,CAApB,CAAuCX,SAAvC,CAAnBF,EAvCD,qBAAA,uCAsDsF,IAAvDP,KAAAA,WAAuD,CAA1CqB,IAAAA,cAA0C,KAA1BL,iBAA0B,CAA1BA,aAAoB,IAAM,CACtFM,EAAMH,EAAWI,MAAXJ,CAAkB,SAASK,CAAT,CAAeC,CAAf,CAAoB,UAC5CA,GAAkC,IAA1BT,IAAkBS,CAAlBT,EAAkCK,EAAeI,CAAfJ,CAAlCL,CAAwDA,EAAkBS,CAAlBT,EAC9DQ,CAFI,CAAAL,CAGT,EAHSA,CADgF,GAKxFD,kBAAoBH,EAAoB,CAAEf,aAAF,CAAegB,mBAAf,CAApBD,CALoE,IAMtFW,KAAuCV,EAAkBE,iBAAlBF,GAAwCtB,EAAqBiC,QAApGD,GAEJE,EAAkBN,EAAIO,YAAtBD,GAAuCA,EAAkBN,EAAIQ,gBAAtBF,CAAvCA,EAAkFA,EAAkBN,EAAIS,kBAAtBH,CAAlFA,EAAuK,IAAxCZ,KAAkBE,wBAC5Ic,QAAOC,MAAPD,CAAcV,CAAdU,CAAmB,CAAEN,qCAAF,CAAnBM,EA/DD,kCAwB6F,SAAnEE,YAAmE,CAAnEA,aAAe,MAAoD,KAA9CC,gBAA8C,CAA9CA,aAAmB,MAA2B,CAArBC,IAAAA,iBAAqB,CAC/FC,EAAyB,IAAhBH,IAAuBC,CAAvBD,CAA0CA,CAD4C,OAEtE,EAArBE,KAAoC,CAAVC,GAA1BD,CAAyC,CAAzCA,CAA6CC,EAASD,EA1BxD,kCA6BqF,IAA3DE,KAAAA,iBAAkBhC,IAAAA,QAASiC,IAAAA,YAAaC,IAAAA,sBACjEF,KAAqB5C,EAAqBiC,QAA1CW,CAAqDhC,CAArDgC,CAAgEhC,EAAUiC,CAAVjC,CAAwBkC,EA9BzF,aAAA,oBASczB,CATd,sBAAA,kBAWYjB,EACjB,4CADiBA,CAEjB,sCAFiBA,CAGjBC,CAHiBD,CAXZ,+BAuEuB2C,EAAKC,EAAUC,EAAK,KAChC,IAAK,EAAlBD,SAAkC,MAEd,IAApBD,IAAIG,eACwB,CAA5BH,KAAIG,YAAJH,CAAiBI,WACjBC,GAAYJ,EAAYA,EAASK,KAArBL,CAA6B,KAEzCM,EAAoBP,EAAIG,YAAJH,CAAiB/B,IAAjB+B,CAAsB,UAAA,QAAKQ,GAAEC,UAAFD,EAAgBtD,EAAewD,SAAfxD,CAAyB,CAAE2B,IAAK2B,CAAP,CAAUH,UAAV,CAAoBM,SAAU,eAA9B,CAA+CC,OAAQ,aAAvD,CAAsEV,KAAtE,CAAzBhD,CAA3C,CAAA8C,KAEpBO,EAAmB,IAClBM,GAAYN,EAAkBO,aADZ,CAElBC,EAAUR,EAAkBS,WAFV,GAIJC,sBAAyBjE,EAAUkE,aAAVlE,CAAwB6D,CAAxB7D,EAAsC,EAAtCA,CAA2CE,EAAeiE,sBAAfjE,CAAsC2D,CAAtC3D,CAAiDgD,CAAjDhD,EAAsDkE,MAAtDlE,CAA6D,YAA7DA,CAJhE,GAKJmE,oBAAuBrE,EAAUsE,eAAVtE,CAA0B+D,CAA1B/D,EAAsC,EAAtCA,CAA2CE,EAAeiE,sBAAfjE,CAAsC6D,CAAtC7D,CAA+CgD,CAA/ChD,EAAoDkE,MAApDlE,CAA2D,YAA3DA,QAE9EqD,IAvFD,qCA0F6BP,EAAKC,EAAUC,EAAK;;;;;;;;;;IACtC,IAAK,EAAlBD,SAAkC,MAWd,IAApBD,IAAIG,eACwB,CAA5BH,KAAIG,YAAJH,CAAiBI,WACjBC,GAAYJ,EAAYA,EAASK,KAArBL,CAA6B,KAIzCsB,EAAmBvB,EAAIG,YAAJH,CAAiBwB,MAAjBxB,CAAwB,UAAA,QAAK,CAACQ,EAAEC,UAAH,EAAiBvD,EAAewD,SAAfxD,CAAyB,CAAE2B,IAAK2B,CAAP,CAAUH,UAAV,CAAoBM,SAAU,eAA9B,CAA+CC,OAAQ,aAAvD,CAAsEV,KAAtE,CAAzBhD,CAA9C,CAAA8C,EAEnByB,EAAyCxB,EAASyB,wCAClDC,EAAsBxE,EAAWyE,eAAXzE,CACzBoE,CADyBpE,CAEzB,aAFyBA;CAGxB,CAACsE;AAHuBtE,EAKtB0E,EAAoB1E,EAAWyE,eAAXzE,CACvBwE,CADuBxE,CAEvB,eAFuBA;CAGtB,CAACsE;AAHqBtE,EAKpB2E,EAAaD,EAAkB,CAAlBA,KACbC,EAAY,IACXjB,GAAYiB,EAAWhB,aADZ,CAEXC,EAAUe,EAAWd,WAFV,GAGJC,sBAAyBjE,EAAUkE,aAAVlE,CAAwB6D,CAAxB7D,EAAsC,EAAtCA,CAA2CE,EAAeiE,sBAAfjE,CAAsC2D,CAAtC3D,CAAiDgD,CAAjDhD,EAAsDkE,MAAtDlE,CAA6D,YAA7DA,CAHhE,GAIJmE,oBAAuBrE,EAAUsE,eAAVtE,CAA0B+D,CAA1B/D,EAAsC,EAAtCA,CAA2CE,EAAeiE,sBAAfjE,CAAsC6D,CAAtC7D,CAA+CgD,CAA/ChD,EAAoDkE,MAApDlE,CAA2D,YAA3DA,QAEvE4E,IAhID,oCAmI4BjC,EAAkBkC,EAAgB,OAC5C,KAApBlC,GADgE,CAC7B,KAD6B,CAE7DkC,EAAe9D,IAAf8D,CAAoB,UAAA,QAAKC,GAAE7D,KAAF6D,GAAYnC,CAArC,CAAAkC,EAAuDE,KArIxD,+BAwIwB,OACvB,CACN,CAAC,MACM,MADN,aAEa,KAFb,UAGU,KAHV,CAAD,CAIG,MACI,cADJ,aAEW,WAFX,UAGQ,eAHR,CAJH,CAQG,MACI,kBADJ,aAEW,gBAFX,UAGQ,oBAHR,CARH,CADM,CAcN,CAAC,MACM,wBADN,aAEa,gBAFb,UAGU,2BAHV,CAAD,CAIG,MACI,4BADJ,aAEW,oBAFX,UAGQ,+BAHR,CAJH,CAQG,MACI,4BADJ,aAEW,oBAFX,UAGQ,+BAHR,CARH,CAdM;;AAzID,EAwKR,QAAS9C,EAAT,CAA2B+C,CAA3B,CAAgC,OACpB,KAAPA,GAD2B,EAEhB,CAARA,KAGR;;;;IAKA,QAASvE,EAAT,CAAgBwE,CAAhB,CAAuBC,CAAvB,CAA6B,OACxBD,GAAME,cAANF,CAAqBC,CAArBD,CADwB,CACaA,EAAMC,CAAND,CADb,CAExBA,EAAME,cAANF,KAAyBC,CAAzBD,CAFwB,CAEmBA,MAAUC,CAAVD,CAFnB,mHAK7BG,QAAQC,MAARD,CAAe,oBAAfA,EAAqCE,OAArCF,CAA6C,yBAA7CA,CAAwEvF,CAAxEuF"}