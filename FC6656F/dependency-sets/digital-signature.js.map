{"version":3,"file":"digital-signature.js","sources":["../../dependency-sets/digital-signature/components/super-digital-signature/digital-signature.js","../../.ðŸ’©/dependency-sets/digital-signature/templates.js","../../src/config/base-component.js"],"sourcesContent":["import {Component} from 'base-component';\r\n// #---------------------------------------------# //\r\n// #---- Component (super-digital-signature) ----# //\r\n\r\n// props is the directive's isolate scope object\r\n// http://onehungrymind.com/angularjs-sticky-notes-pt-2-isolated-scope\r\nconst props = {\r\n\tmodel: '=?',\r\n\tsignatures: '=?',\r\n\torientation: '=?',\r\n\tsignatureDisplay: '=?',\r\n\tmappable: '=?',\r\n\tlabel: '@',\r\n\tisDisabled: '=?',\r\n\trequired: '=',\r\n\tonBehalf: '@',\r\n\teditMode: '=?',\r\n\torg: '='\r\n};\r\n\r\n// directive definition object overrides\r\nconst config = {};\r\n\r\n/*@ngInject*/\r\nfunction digitalSignature() {\r\n\r\n\tclass DigitalSignature extends Component {\r\n\t\t/*@ngInject*/\r\n\t\tcontroller($scope, $q, ssFormInstancesApi, ssDateByOrgHlp, ssSignatureApi, ssEnum) {\r\n\r\n\t\t\tvar mappedSignatures;\r\n\r\n\t\t\t//grandfather in old forms signed prior to additional of isSigned attr\r\n\t\t\tif ($scope.model != null && $scope.model.isSigned == null) {\r\n\t\t\t\tif ($scope.model.email.length > 0 && $scope.model.employeeName.length > 0) {\r\n\t\t\t\t\t$scope.model.isSigned = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// view model for tracking state\r\n\t\t\tconst vm = $scope.vm = {\r\n\t\t\t\ttimeDisplay: '',\r\n\t\t\t\teditMode: $scope.editMode == null ? true : $scope.editMode,\r\n\t\t\t\tsignatures: [],\r\n\t\t\t\tssEnumSignatureDisplayMethod: ssEnum.signatureDisplayMethod,\r\n\t\t\t\tsignatureDisplay: $scope.signatureDisplay || 'step-participant'\r\n\t\t\t};\r\n\r\n\t\t\t$scope.$watch('model', (nv, ov) => {\r\n\t\t\t\tif (nv == null) {\r\n\t\t\t\t\t$scope.model = {\r\n\t\t\t\t\t\tname: '', // this is the name in the input\r\n\t\t\t\t\t\temployeeName: '', // this is the name on the getEmployee model\r\n\t\t\t\t\t\tonBehalf: $scope.onBehalf || null,\r\n\t\t\t\t\t\tuserIP: '',\r\n\t\t\t\t\t\tuser: '',\r\n\t\t\t\t\t\temail: '',\r\n\t\t\t\t\t\tisSigned: false\r\n\t\t\t\t\t};\r\n\t\t\t\t} else {\r\n\t\t\t\t// isSigned update to add additional fields because of a bug that let in some bad data, but IP address didn't get set properly\r\n\t\t\t\t\tvm.isSigned = nv.name != null && nv.name.length > 0 && (nv.userIP != null && nv.userIP.length > 0);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t$scope.$watch('onBehalf', (nv, ov) => {\r\n\t\t\t\tif ($scope.model != null) {\r\n\t\t\t\t\t$scope.model.onBehalf = nv === 'true';\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t$scope.$watch('model.time', (nv, ov) => {\r\n\t\t\t\tif (nv == null) { return; }\r\n\r\n\t\t\t\tlet timeMoment = ssDateByOrgHlp.utcIsoToRelativeMoment(nv, $scope.org);\r\n\r\n\t\t\t\tvm.timeDisplay = timeMoment.calendar(null, { // jshint ignore:line\r\n\t\t\t\t\tsameDay: '[Today at] LT',\r\n\t\t\t\t\tlastDay: '[Yesterday at] LT',\r\n\t\t\t\t\tlastWeek: 'ddd [at] LT',\r\n\t\t\t\t\tsameElse: 'L [at] LT'\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\t$scope.$watch('signatures', (nv, ov) => {\r\n\t\t\t\tif (nv == null) { return; }\r\n\t\t\t\tlet ids = nv;\r\n\r\n\t\t\t\tvm.signatureGroups = [];\r\n\t\t\t\tvm.loading = true;\r\n\r\n\t\t\t\t//Use $q.all because of delay processing until they all come back, can maintain sort order\r\n\t\t\t\tlet signaturePromises = [];\r\n\t\t\t\tids.forEach(id => {\r\n\t\t\t\t\tsignaturePromises.push(ssSignatureApi.get({id: id}));\r\n\t\t\t\t});\r\n\r\n\t\t\t\t$q.all(signaturePromises).then(signatures => {\r\n\t\t\t\t\tmappedSignatures = signatures.filter(s => s).map(s => {\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tid: s.id,\r\n\t\t\t\t\t\t\tname: s._name,\r\n\t\t\t\t\t\t\ttitle: s._title,\r\n\t\t\t\t\t\t\tdisplayMethod: s._displayMethod,\r\n\t\t\t\t\t\t\timageUrl: s._imageUrl\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t});\r\n\t\t\t\t\tvm.signatureGroups = groupByOrientation(mappedSignatures, $scope.orientation);\r\n\t\t\t\t\tvm.loading = false;\r\n\t\t\t\t\tvm.loadingStatus = '';\r\n\t\t\t\t}, rej => {\r\n\t\t\t\t\tvm.loading = false;\r\n\t\t\t\t\tvm.loadingStatus = '';\r\n\t\t\t\t\t//> error('ERROR', rej);\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\t$scope.$watch('orientation', (nv, ov) => {\r\n\t\t\t\tif (nv === ov) { return; }\r\n\t\t\t\tvm.signatureGroups = groupByOrientation(mappedSignatures, nv);\r\n\t\t\t});\r\n\r\n\t\t\t$scope.$watch('signatureDisplay', (nv, ov) => {\r\n\t\t\t\tif (nv === ov) { return; }\r\n\t\t\t\tvm.signatureDisplay = nv;\r\n\t\t\t});\r\n\r\n\t\t\t$scope.$watch('mappable', (nv, ov) => {\r\n\t\t\t\tif (vm.signatureDisplay === 'saved-signatures') {\r\n\t\t\t\t\t$scope.mappable = false;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t// behavior that needs to be bound to the view\r\n\t\t\tconst go = $scope.go = { // eslint-disable-line no-unused-vars\r\n\t\t\t\taddSignature() {\r\n\t\t\t\t\tif ($scope.model.name.trim() === '') { return false; }\r\n\r\n\t\t\t\t\tvm.loading = true;\r\n\t\t\t\t\tvm.loadingStatus = 'creating signature...';\r\n\r\n\t\t\t\t\tssFormInstancesApi.signature($scope.model.name).then(res => {\r\n\t\t\t\t\t\tlet data = res.data.data.attributes;\r\n\r\n\t\t\t\t\t\t$scope.model.time = data.time;\r\n\t\t\t\t\t\t$scope.model.userIP = data.userIP;\r\n\t\t\t\t\t\t$scope.model.employeeName = data.employeeName;\r\n\t\t\t\t\t\t$scope.model.email = data.email;\r\n\t\t\t\t\t\t$scope.model.user = data.user;\r\n\r\n\t\t\t\t\t\t$scope.model.isSigned = true;\r\n\r\n\t\t\t\t\t\tvm.loading = false;\r\n\t\t\t\t\t\tvm.loadingStatus = '';\r\n\t\t\t\t\t\tvm.isSigned = true;\r\n\r\n\t\t\t\t\t\t// add a link function to  get the element here and pass that through as the last parameter\r\n\t\t\t\t\t\t$scope.$emit('ss-validate-field-event', $scope.element, 'change');\r\n\t\t\t\t\t}, rej => {\r\n\r\n\t\t\t\t\t\t// Call failed so reset the form.\r\n\t\t\t\t\t\tvm.loading = false;\r\n\t\t\t\t\t\tvm.loadingStatus = '';\r\n\t\t\t\t\t\t$scope.model.isSigned = false;\r\n\t\t\t\t\t\tvm.isSigned = false;\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tfunction groupByOrientation(items, orientation) {\r\n\t\t\t\tlet grouped = [],\r\n\t\t\t\tindex = 0;\r\n\r\n\t\t\t\tlet groupSize = orientation === 'h' ? 2 : 1;\r\n\r\n\t\t\t\tfor (let i = 0; i < items.length; i++) {\r\n\t\t\t\t\tif (angular.isUndefined(grouped[index])) {\r\n\t\t\t\t\t\tgrouped[index] = [];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tgrouped[index].push(items[i]);\r\n\t\t\t\t\tif ((i+1) % groupSize === 0) {\r\n\t\t\t\t\t\tindex++;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn grouped;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlink(scope, elem, attrs) {\r\n\t\t\t// This is needed to pass the element through to the contoller so that we can validate the form AFTER we click the 'Add Dig Sig' button\r\n\t\t\tscope.element = elem;\r\n\t\t}\r\n\t}\r\n\r\n\treturn new DigitalSignature(props, 'digital-signature', config);\r\n}\r\n\r\n// #-- END Component (super-digital-signature) --# //\r\n// #---------------------------------------------# //\r\n\r\nangular.module('super-suit-components').directive('superDigitalSignature', digitalSignature);\r\n","(function(e){try{e=angular.module(\"super-templates\")}catch(t){e=angular.module(\"super-templates\",[])}e.run([\"$templateCache\",function(c){c.put('components/super-digital-signature/digital-signature.html',`<div class=\"super-digital-signature\"><div ng-if=\"vm.signatureDisplay === 'step-participant'\"><div ng-if=\"!vm.isSigned\"><super-input-text required=\"required\" is-disabled=\"isDisabled\" label=\"{{label}}\" edit-mode=\"vm.editMode\" model=\"model.name\"></super-input-text><super-button ng-if=\"vm.editMode\" label=\"Add Digital Signature\" ng-click=\"go.addSignature()\" is-disabled=\"isDisabled || model.name.trim().length === 0\" aria-controls=\"progress-indicator-{{::$id}}, signature-details-{{::$id}}\"></super-button></div><div id=\"signature-details-{{::$id}}\" ng-if=\"!vm.loading && vm.isSigned\"><p class=\"typed-name\" ss-icon-after=\"shield\">{{model.name}}</p><dl class=\"gd-row signature-details\"><div class=\"gd-50p\"><dt>Signed:</dt><dd>&nbsp;{{model.employeeName}}</dd><dt>Time:</dt><dd>&nbsp;{{vm.timeDisplay}}</dd><dt>IP Address:</dt><dd>&nbsp;{{model.userIP}}</dd></div><div class=\"gd-50p\"><dt>User:</dt><dd>&nbsp;{{model.employeeName}} <span ng-if=\"model.onBehalf\">on behalf of {{model.employeeName}}</span></dd><dt>Email:</dt><dd>&nbsp;{{model.email}}</dd></div></dl></div></div><div class=\"no-signatures\" ng-if=\"vm.signatureDisplay === 'saved-signatures' && vm.signatureGroups.length < 1 && !vm.loading\"><h3>No signatures yet</h3><p>To add a signature, choose an option from the<br>Signatures Properties panel</p></div><ul class=\"saved-signature-list\" ng-class=\"{'horizontal': orientation === 'h', 'vertical': orientation === 'v'}\" ng-if=\"vm.signatureDisplay === 'saved-signatures' && vm.signatureGroups.length > 0\"><li class=\"saved-signature-group\" ng-repeat=\"group in vm.signatureGroups\"><div class=\"signature\" ng-repeat=\"signature in group\"><p>Signed by</p><figure><div class=\"typed-name\" ng-if=\"signature.displayMethod === vm.ssEnumSignatureDisplayMethod.typed\">{{signature.name}}</div><img class=\"signed-name\" ng-if=\"signature.displayMethod === vm.ssEnumSignatureDisplayMethod.image\" ng-src=\"{{signature.imageUrl}}\" height=\"50\" alt=\"{{signature.name}} signature image\"><figcaption class=\"signature-{{::$id}}\">{{signature.name}} ({{signature.title}})</figcaption></figure></div></li></ul><super-loader id=\"progress-indicator-{{::$id}}\" is-loading=\"vm.loading\" status-text=\"vm.loadingStatus\" fill role=\"status\"></super-loader></div>`);}])}())","export class Component {\r\n\tconstructor(props, cmptName, config = {}) {\r\n\r\n\t\tthis.restrict = 'E';\r\n\t\tthis.replace = true;\r\n\t\tthis.scope = props;\r\n\t\tthis.templateUrl = `components/super-${cmptName}/${cmptName}.html`;\r\n\r\n\t\tObject.assign(this, config);\r\n\t}\r\n}\r\n"],"names":["e","angular","module","t","run","c","put","props","cmptName","config","restrict","replace","scope","templateUrl","assign","directive","DigitalSignature","$scope","$q","ssFormInstancesApi","ssDateByOrgHlp","ssSignatureApi","ssEnum","groupByOrientation","items","orientation","grouped","index","groupSize","i","length","isUndefined","push","mappedSignatures","model","isSigned","email","employeeName","vm","editMode","signatureDisplayMethod","signatureDisplay","$watch","nv","onBehalf","name","userIP","timeMoment","utcIsoToRelativeMoment","org","timeDisplay","calendar","signatureGroups","loading","signaturePromises","forEach","get","id","all","then","signatures","filter","s","map","_name","_title","_displayMethod","_imageUrl","loadingStatus","ov","mappable","go","trim","signature","data","res","attributes","time","user","$emit","element","elem","Component"],"mappings":"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"}